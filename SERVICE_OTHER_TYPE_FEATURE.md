# 📝 إضافة خيار "أخرى" في نوع الوحدة - Service DocType

## 🎯 التغييرات المطبقة

تم إضافة خيار جديد **"أخرى"** في حقل **نوع الوحدة** (`type_unit`) داخل DocType **Service**.

---

## ✅ الميزات الجديدة

### 1️⃣ خيار "أخرى" في نوع الوحدة

تم إضافة الخيار **"أخرى"** (Others) إلى قائمة أنواع الوحدات المتاحة:

**الخيارات الحالية:**
1. مدة (Duration)
2. Reels
3. Photo
4. Promo
5. Photo Session
6. Series
7. Podcast Ep
8. **أخرى** ← ✨ جديد

### 2️⃣ حقل "ملاحظات" يظهر عند اختيار "أخرى"

عند اختيار **"أخرى"** من قائمة نوع الوحدة:
- يظهر حقل **"ملاحظات"** (`notes`) تلقائياً
- نوع الحقل: **Small Text** (نص متعدد الأسطر)
- يمكن إدخال أي معلومات إضافية عن نوع الوحدة

**الشرط:**
```javascript
depends_on: "eval:doc.type_unit == 'أخرى'"
```

---

## 🔧 التطبيق التقني

### الملف المعدل:
**`service.json`**

#### التعديل 1: إضافة "أخرى" في خيارات type_unit

```json
{
  "fieldname": "type_unit",
  "fieldtype": "Select",
  "label": "نوع الوحدة",
  "options": "\nمدة\nReels\nPhoto\nPromo\nPhoto Session\nSeries\nPodcast Ep\nأخرى"
}
```

#### التعديل 2: إضافة شرط العرض لحقل notes

```json
{
  "depends_on": "eval:doc.type_unit == 'أخرى'",
  "fieldname": "notes",
  "fieldtype": "Small Text",
  "label": "ملاحظات"
}
```

**قبل التعديل:**
- حقل `notes` كان يظهر دائماً بدون شرط

**بعد التعديل:**
- حقل `notes` يظهر فقط عند اختيار "أخرى" في `type_unit`

---

## 📋 سيناريو الاستخدام

### الحالة 1: اختيار "Reels"
```
نوع الوحدة: Reels
عدد/الكمية: 10 ← يظهر
ملاحظات: ← لا يظهر ❌
```

### الحالة 2: اختيار "مدة"
```
نوع الوحدة: مدة
المدة الافتراضية: 2 ساعة ← يظهر
وحدة المدة: ساعة ← يظهر
عدد/الكمية: ← لا يظهر ❌
ملاحظات: ← لا يظهر ❌
```

### الحالة 3: اختيار "أخرى" ✨
```
نوع الوحدة: أخرى
عدد/الكمية: 5 ← يظهر
ملاحظات: "خدمة تصوير خاصة للمناسبات" ← يظهر ✅
```

---

## 🧪 الاختبار

### خطوات الاختبار:

1. افتح **Service** من قائمة DocTypes
2. افتح خدمة موجودة أو أنشئ جديدة
3. انتقل إلى تبويب **"المدة والتسعير"**
4. في قسم **"إعدادات المدة"**:
   - اختر **"أخرى"** من قائمة **"نوع الوحدة"**
5. ✅ تحقق من ظهور حقل **"ملاحظات"** أسفل حقل **"عدد/الكمية"**
6. أدخل نصاً في حقل **"ملاحظات"**
7. احفظ الخدمة
8. أعد فتح الخدمة وتحقق من حفظ الملاحظات

### اختبار الشرط:

```javascript
// اختبار 1: تغيير من "أخرى" إلى "Reels"
نوع الوحدة: أخرى → Reels
النتيجة: حقل "ملاحظات" يختفي ✅

// اختبار 2: تغيير من "Photo" إلى "أخرى"
نوع الوحدة: Photo → أخرى
النتيجة: حقل "ملاحظات" يظهر ✅

// اختبار 3: اختيار "مدة"
نوع الوحدة: مدة
النتيجة: حقل "ملاحظات" لا يظهر ✅
```

---

## 📊 حقول Service حسب نوع الوحدة

| نوع الوحدة | المدة الافتراضية | وحدة المدة | عدد/الكمية | ملاحظات |
|------------|------------------|-----------|-----------|---------|
| مدة | ✅ يظهر | ✅ يظهر | ❌ مخفي | ❌ مخفي |
| Reels | ❌ مخفي | ❌ مخفي | ✅ يظهر | ❌ مخفي |
| Photo | ❌ مخفي | ❌ مخفي | ✅ يظهر | ❌ مخفي |
| Promo | ❌ مخفي | ❌ مخفي | ✅ يظهر | ❌ مخفي |
| Photo Session | ❌ مخفي | ❌ مخفي | ✅ يظهر | ❌ مخفي |
| Series | ❌ مخفي | ❌ مخفي | ✅ يظهر | ❌ مخفي |
| Podcast Ep | ❌ مخفي | ❌ مخفي | ✅ يظهر | ❌ مخفي |
| **أخرى** | ❌ مخفي | ❌ مخفي | ✅ يظهر | **✅ يظهر** |

---

## 🎨 واجهة المستخدم

### عند اختيار "أخرى":

```
┌─────────────────────────────────────────────┐
│ إعدادات المدة                               │
├─────────────────────────────────────────────┤
│ نوع الوحدة:                                 │
│ ┌──────────────────┐                        │
│ │ أخرى        ▼   │                        │
│ └──────────────────┘                        │
│                                             │
│ عدد / الكمية:                               │
│ ┌──────────────────┐                        │
│ │ 10               │                        │
│ └──────────────────┘                        │
│                                             │
│ ملاحظات: ✨                                 │
│ ┌─────────────────────────────────────────┐ │
│ │ خدمة تصوير خاصة للمناسبات              │ │
│ │ تشمل تجهيزات إضافية                     │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

### عند اختيار أي نوع آخر (مثلاً "Photo"):

```
┌─────────────────────────────────────────────┐
│ إعدادات المدة                               │
├─────────────────────────────────────────────┤
│ نوع الوحدة:                                 │
│ ┌──────────────────┐                        │
│ │ Photo       ▼   │                        │
│ └──────────────────┘                        │
│                                             │
│ عدد / الكمية:                               │
│ ┌──────────────────┐                        │
│ │ 50               │                        │
│ └──────────────────┘                        │
│                                             │
│ (حقل الملاحظات مخفي)                       │
└─────────────────────────────────────────────┘
```

---

## 💡 حالات الاستخدام

### متى نستخدم "أخرى"?

1. **خدمات مخصصة:**
   - خدمة تصوير غير مصنفة ضمن الأنواع الموجودة
   - مثال: "تصوير طائرات بدون طيار (Drone)"

2. **خدمات مؤقتة:**
   - عروض موسمية أو خاصة
   - مثال: "تصوير رمضاني خاص"

3. **خدمات تجريبية:**
   - خدمات جديدة قيد التجربة
   - مثال: "تصوير 360 درجة"

4. **وحدات قياس غير تقليدية:**
   - قد لا تتناسب مع الخيارات الموجودة
   - مثال: "باقة شاملة - كل المخرجات"

**مثال على الملاحظات:**
```
الملاحظات: "خدمة تصوير بتقنية 3D - تشمل 5 مشاهد ثلاثية الأبعاد مع 
معالجة ما بعد الإنتاج. الوحدة هنا تمثل عدد المشاهد وليس الوقت."
```

---

## ✅ التحقق من التطبيق

### اختبار من Frappe Console:

```python
import frappe

# جلب Service
doc_meta = frappe.get_meta("Service")

# التحقق من خيارات type_unit
type_unit_field = doc_meta.get_field("type_unit")
print("خيارات نوع الوحدة:")
for opt in type_unit_field.options.split('\n'):
    if opt:
        print(f"  - {opt}")

# التحقق من شرط حقل notes
notes_field = doc_meta.get_field("notes")
print(f"\nشرط عرض الملاحظات: {notes_field.depends_on}")

# النتيجة المتوقعة:
# ✅ "أخرى" موجودة في الخيارات
# ✅ depends_on = "eval:doc.type_unit == 'أخرى'"
```

---

## 🔄 التدفق الكامل

```
فتح Service
    ↓
انتقل إلى تبويب "المدة والتسعير"
    ↓
اختر "نوع الوحدة" = أخرى
    ↓
يظهر حقل "ملاحظات" تلقائياً ✨
    ↓
أدخل معلومات إضافية في الملاحظات
    ↓
احفظ الخدمة ✅
    ↓
عند فتح الخدمة مرة أخرى:
    - إذا كان type_unit = "أخرى" → حقل الملاحظات يظهر ✅
    - إذا كان type_unit = غير ذلك → حقل الملاحظات مخفي ❌
```

---

## 📁 الملفات المعدلة

1. **`service.json`**
   - إضافة "أخرى" في خيارات `type_unit`
   - إضافة `depends_on` لحقل `notes`

---

## 🎉 الخلاصة

تم بنجاح:
- ✅ إضافة خيار **"أخرى"** في نوع الوحدة
- ✅ جعل حقل **"ملاحظات"** يظهر فقط عند اختيار "أخرى"
- ✅ تطبيق التغييرات على قاعدة البيانات (migrate)
- ✅ مسح الذاكرة المؤقتة وإعادة تشغيل النظام
- ✅ اختبار التغييرات والتحقق من عملها بنجاح

الميزة جاهزة للاستخدام! 🚀

---

## 📝 ملاحظات إضافية

1. **الحقل اختياري:** حقل الملاحظات غير إجباري (`reqd: 0`)
2. **نوع الحقل:** Small Text (يسمح بعدة أسطر)
3. **التوافق:** يعمل مع جميع الخدمات الموجودة والجديدة
4. **المرونة:** يمكن ترك الملاحظات فارغة حتى عند اختيار "أخرى"

---

تاريخ التطبيق: 18 أكتوبر 2025
