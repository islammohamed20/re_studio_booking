# ุฅุถุงูุฉ ุญูู ุงูููุธู ุงูุญุงูู (Current Employee Field)

## ุงูุชุงุฑูุฎ: 19 ุฃูุชูุจุฑ 2025

## ุงููุฏู ูู ุงูุชุญุฏูุซ

ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ ูุนุฑุถ **ุงูููุธู ุงูุญุงูู** (ุงููุณุชุฎุฏู ุงููุณุฌู ุฏุฎููู) ุชููุงุฆูุงู ูู ูุณุชูุฏ Bookingุ ูุน ุนุฑุถ **ุงูุงุณู ุงููุงูู** ููููุธู.

---

## ุงูุญููู ุงููุถุงูุฉ

### 1. ุญูู ุงูููุธู (current_employee)
- **ุงูุงุณู**: `current_employee`
- **ุงูููุน**: Link (User)
- **ุงูุนููุงู**: "ุงูููุธู"
- **ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ**: `__user` (ุงููุณุชุฎุฏู ุงูุญุงูู)
- **ูููุฑุงุกุฉ ููุท**: ูุนู (read_only: 1)

### 2. ุญูู ุงุณู ุงูููุธู ุงููุงูู (current_employee_full_name)
- **ุงูุงุณู**: `current_employee_full_name`
- **ุงูููุน**: Data
- **ุงูุนููุงู**: "ุงุณู ุงูููุธู ุงููุงูู"
- **ูุตุฏุฑ ุงูุจูุงูุงุช**: ูุชู ุฌูุจู ุชููุงุฆูุงู ูู `current_employee.full_name`
- **ูุธูุฑ ูู ุงููุงุฆูุฉ**: ูุนู (in_list_view: 1)
- **ูููุฑุงุกุฉ ููุท**: ูุนู (read_only: 1)

---

## ุขููุฉ ุงูุนูู

### ูู Frontend (JavaScript)

```javascript
// ูู ุญุฏุซ refresh
if (frm.is_new() && !frm.doc.current_employee) {
	frm.set_value('current_employee', frappe.session.user);
}
```

**ุงููุธููุฉ:**
- ุนูุฏ ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏุ ูุชู ุชุนููู `current_employee` ุชููุงุฆูุงู ุฅูู ุงููุณุชุฎุฏู ุงูุญุงูู
- ูุชู ุงุณุชุฎุฏุงู `frappe.session.user` ููุญุตูู ุนูู ูุนุฑู ุงููุณุชุฎุฏู ุงูุญุงูู

### ูู Backend (Python)

```python
def before_save(self):
	"""ุชูููุฐ ุงูุนูููุงุช ูุจู ุงูุญูุธ"""
	# 0. ุชุนููู ุงูููุธู ุงูุญุงูู ุชููุงุฆูุงู
	if not self.current_employee:
		self.current_employee = frappe.session.user
	
	# ... ุจุงูู ุงูููุฏ
```

**ุงููุธููุฉ:**
- ูุจู ุญูุธ ุงููุณุชูุฏุ ูุชู ุงูุชุญูู ูู ูุฌูุฏ ูููุฉ ูู `current_employee`
- ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ูุชู ุชุนูููู ุชููุงุฆูุงู ุฅูู `frappe.session.user`
- ูุฐุง ูุถูู ุญูุธ ุงูููุธู ุญุชู ูู ุชู ุงูุญูุธ ูู ุงูู API ุฃู Script

---

## ูููุน ุงูุญููู ูู ุงููููุฐุฌ

ุงูุญููู ุชุธูุฑ ูู ูุณู **"ููุน ุงูุญุฌุฒ"** (booking_type_section):

```
ููุน ุงูุญุฌุฒ (booking_type_section)
โโโ ููุน ุงูุญุฌุฒ (booking_type)
โโโ ุงููุตูุฑ (photographer)
โโโ Photographer B2B (photographer_b2b)
โโโ [Column Break]
โโโ โญ ุงูููุธู (current_employee) [ุฌุฏูุฏ]
โโโ โญ ุงุณู ุงูููุธู ุงููุงูู (current_employee_full_name) [ุฌุฏูุฏ]
โโโ ููุธู (agent) - ุญูู ูุฏูู
```

---

## ุงููุฑู ุจูู ุงูุญูููู

### ๐ current_employee (ุงูููุธู ุงูุญุงูู)
- **ุชููุงุฆู**: ูุชู ุชุนูููู ุชููุงุฆูุงู ูููุณุชุฎุฏู ุงูุญุงูู
- **ูููุฑุงุกุฉ ููุท**: ูุง ูููู ุชุนุฏููู
- **ุงูุบุฑุถ**: ุชุชุจุน ูู ูุงู ุจุฅูุดุงุก ุงูุญุฌุฒ ูุนููุงู
- **ูุนุฑุถ**: Full Name ูู User

### ๐ต agent (ููุธู)
- **ูุฏูู**: ูููู ุงุฎุชูุงุฑู ูุฏููุงู
- **ูุงุจู ููุชุนุฏูู**: ูููู ุชุบููุฑู
- **ุงูุบุฑุถ**: ุชุนููู ููุธู ูุณุคูู ุนู ุงูุญุฌุฒ (ูุฏ ูููู ูุฎุชูู ุนู ุงูููุดุฆ)
- **ูุนุฑุถ**: User ID

---

## ุชุญุฏูุซุงุช ุงููููุงุช

### 1. booking.json
**ุงูุชุบููุฑุงุช:**

#### ุฃ) field_order (ุฅุถุงูุฉ ุงูุญููู ููุชุฑุชูุจ)
```json
"field_order": [
  ...
  "booking_type",
  "photographer",
  "photographer_b2b",
  "column_break_zteg",
  "current_employee",              // โญ ุฌุฏูุฏ
  "current_employee_full_name",    // โญ ุฌุฏูุฏ
  "agent",
  ...
]
```

#### ุจ) fields (ุชุนุฑูู ุงูุญููู)
```json
{
  "default": "__user",
  "fieldname": "current_employee",
  "fieldtype": "Link",
  "label": "ุงูููุธู",
  "options": "User",
  "read_only": 1
},
{
  "fetch_from": "current_employee.full_name",
  "fieldname": "current_employee_full_name",
  "fieldtype": "Data",
  "in_list_view": 1,
  "label": "ุงุณู ุงูููุธู ุงููุงูู",
  "read_only": 1
}
```

### 2. booking.py
**ุงูุชุบููุฑ:**

```python
def before_save(self):
	"""ุชูููุฐ ุงูุนูููุงุช ูุจู ุงูุญูุธ"""
	# 0. ุชุนููู ุงูููุธู ุงูุญุงูู ุชููุงุฆูุงู
	if not self.current_employee:
		self.current_employee = frappe.session.user
	
	# 1. ุชุบููุฑ ุงูุญุงูุฉ ุฅูู Confirmed ุนูุฏ ุงูุญูุธ
	if self.status != 'Confirmed':
		self.status = 'Confirmed'
	
	# ... ุจุงูู ุงูููุฏ
```

### 3. booking.js
**ุงูุชุบููุฑ:**

```javascript
refresh: function(frm) {
	// Set default booking type if not set
	if (!frm.doc.booking_type) {
		frm.set_value('booking_type', 'Service');
	}
	
	// ุชุนููู ุงูููุธู ุงูุญุงูู ุชููุงุฆูุงู ูููุณุชูุฏุงุช ุงูุฌุฏูุฏุฉ
	if (frm.is_new() && !frm.doc.current_employee) {
		frm.set_value('current_employee', frappe.session.user);
	}
	
	// ... ุจุงูู ุงูููุฏ
}
```

---

## ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุญุฏูุซ ููู JSON
โ ุฅุถุงูุฉ `current_employee` ู `current_employee_full_name` ุฅูู `field_order`  
โ ุฅุถุงูุฉ ุชุนุฑููุงุช ุงูุญููู ูู ูุณู `fields`

### 2. ุชุญุฏูุซ ููู Python
โ ุฅุถุงูุฉ ููุทู ุชุนููู `current_employee` ูู `before_save()`

### 3. ุชุญุฏูุซ ููู JavaScript
โ ุฅุถุงูุฉ ููุทู ุชุนููู `current_employee` ูู `refresh` event

### 4. ุชุทุจูู ุงูุชุบููุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
bench --site site1.local migrate
```
โ **ุชู ุงูุชูููุฐ ุจูุฌุงุญ**

### 5. ุฅุนุงุฏุฉ ุชุดุบูู ุงููุธุงู
```bash
bench restart
```
โ **ุชู ุงูุชูููุฐ ุจูุฌุงุญ**

---

## ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### โ ุณููุงุฑูู 1: ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ
1. ุชุณุฌูู ุงูุฏุฎูู ููุณุชุฎุฏู (ูุซูุงู: user@example.com)
2. ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ุญูู "ุงูููุธู" = user@example.com
   - ุญูู "ุงุณู ุงูููุธู ุงููุงูู" = "ูุญูุฏ ุฃุญูุฏ" (Full Name ูู User)

### โ ุณููุงุฑูู 2: ุญูุธ ุญุฌุฒ ููุฌูุฏ
1. ูุชุญ ุญุฌุฒ ููุฌูุฏ
2. ุชุนุฏูู ุจุนุถ ุงูุจูุงูุงุช
3. ุญูุธ
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ุญูู "ุงูููุธู" ูุจูู ููุง ูู (ุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃ ุงูุญุฌุฒ ุฃุตูุงู)
   - ูุง ูุชุบูุฑ ุฅูู ุงููุณุชุฎุฏู ุงูุญุงูู

### โ ุณููุงุฑูู 3: ุนุฑุถ ูู ุงููุงุฆูุฉ
1. ุงูุฐูุงุจ ุฅูู ูุงุฆูุฉ Bookings
2. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ุนููุฏ "ุงุณู ุงูููุธู ุงููุงูู" ูุธูุฑ ูู ุงููุงุฆูุฉ
   - ูุนุฑุถ ุงูุงุณู ุงููุงูู ููู ููุธู

### โ ุณููุงุฑูู 4: ุงูุญูู ูููุฑุงุกุฉ ููุท
1. ูุชุญ ุญุฌุฒ ุฌุฏูุฏ ุฃู ููุฌูุฏ
2. ูุญุงููุฉ ุชุนุฏูู ุญูู "ุงูููุธู" ุฃู "ุงุณู ุงูููุธู ุงููุงูู"
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
   - ุงูุญููุงู ุบูุฑ ูุงุจููู ููุชุนุฏูู (read-only)
   - ุงูููู ุฑูุงุฏู ูุงุชุญ

---

## ุงูููุงุฆุฏ

### 1. ุงูุชุชุจุน ุงูุชููุงุฆู โ
- ูุนุฑูุฉ ูู ูุงู ุจุฅูุดุงุก ุงูุญุฌุฒ ุจุฏูู ุงูุญุงุฌุฉ ููุจุญุซ ูู ุงูุณุฌูุงุช
- ุนุฑุถ ุงูุงุณู ุงููุงูู ุจุฏูุงู ูู User ID

### 2. ุงูุชูููุฒ ุจูู ุงูููุดุฆ ูุงููุณุคูู โ
- `current_employee`: ูู ุฃูุดุฃ ุงูุญุฌุฒ ูุนููุงู
- `agent`: ูู ูู ุงููุณุคูู ุนู ูุชุงุจุนุฉ ุงูุญุฌุฒ (ูุฏ ูููู ุดุฎุต ุขุฎุฑ)

### 3. ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช โ
- ุฅููุงููุฉ ุนูู ุชูุงุฑูุฑ ุญุณุจ ุงูููุธู
- ูุนุฑูุฉ ุนุฏุฏ ุงูุญุฌูุฒุงุช ููู ููุธู
- ุชุชุจุน ุงูุฃุฏุงุก

### 4. ุงูุฃูุงู โ
- ุงูุญูู ูููุฑุงุกุฉ ููุทุ ูุง ูููู ุงูุชูุงุนุจ ุจู
- ูุชู ุงูุชุนููู ุชููุงุฆูุงู ูู `frappe.session.user`

---

## ููุงุญุธุงุช ูููุฉ

### โ๏ธ ุงููุฑู ุจูู `__user` ู `frappe.session.user`

- **`__user`**: ูููุฉ ุงูุชุฑุงุถูุฉ ูู JSONุ ุชุนูู ูู Frontend ููุท
- **`frappe.session.user`**: ูุนูู ูู Frontend ู Backend
- **ุงูุญู**: ุงุณุชุฎุฏููุง ููุงููุง ูุถูุงู ุงูุนูู ูู ุฌููุน ุงูุญุงูุงุช

### โ๏ธ fetch_from vs set_value

- **`fetch_from`**: ูุชู ุฌูุจ ุงููููุฉ ุชููุงุฆูุงู ูู DocType ุขุฎุฑ
- ูู ุญุงูุชูุง: `current_employee_full_name` ูุชู ุฌูุจู ูู `current_employee.full_name`
- ูุง ุญุงุฌุฉ ูููุฏ ุฅุถุงููุ Frappe ูุชุนุงูู ูุนู ุชููุงุฆูุงู

### โ๏ธ read_only vs disabled

- **`read_only: 1`**: ุงูุญูู ูุธูุฑ ุจููู ุฑูุงุฏู ูุงุชุญุ ูุง ูููู ุชุนุฏููู
- **`disabled: 1`**: ุงูุญูู ูุนุทู ุจุงููุงูู
- ุงุณุชุฎุฏููุง `read_only` ูุฃูู ุฃูุซุฑ ูุถูุญุงู ูููุณุชุฎุฏู

---

## ุงูููุฎุต

โ **ุชู ุฅุถุงูุฉ ุญูููู ุฌุฏูุฏูู:**
1. **ุงูููุธู** (current_employee) - Link ุฅูู User
2. **ุงุณู ุงูููุธู ุงููุงูู** (current_employee_full_name) - ุงุณู ูุงูู

โ **ูุชู ุงูุชุนููู ุชููุงุฆูุงู:**
- ุนูุฏ ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ
- ูุชู ุญูุธ ุงููุณุชุฎุฏู ุงูุญุงูู
- ุนุฑุถ ุงูุงุณู ุงููุงูู

โ **ูููุฑุงุกุฉ ููุท:**
- ูุง ูููู ุงูุชุนุฏูู
- ุถูุงู ุตุญุฉ ุงูุจูุงูุงุช

โ **ูุธูุฑ ูู ุงููุงุฆูุฉ:**
- ุณูููุฉ ุงูุชุชุจุน
- ูุนุฑูุฉ ูู ุฃูุดุฃ ูู ุญุฌุฒ

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: 19 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ููุชูู ููุทุจู  
**ุงูุฅุตุฏุงุฑ**: 1.0
