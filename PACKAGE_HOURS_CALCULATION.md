# ๐ ุชูุซูู ุญุณุงุจ ุณุงุนุงุช ุงูุจุงูุฉ - Package Hours Calculation

## ๐ฏ ุงูููุฒุงุช ุงููุทุจูุฉ

### โ 1. ุงุฎุชูุงุฑ ุงูุจุงูุฉ
ุนูุฏ ุงุฎุชูุงุฑ ุจุงูุฉ ูู ูููุฐุฌ Booking:
- ูุชู ููุก ุญูู **ุนุฏุฏ ุงูุณุงุนุงุช ุงููุชุจููุฉ** (`remaining_hours`) ุชููุงุฆูุงู ูู ุฅุฌูุงูู ุณุงุนุงุช ุงูุจุงูุฉ (`total_hours`)
- ูุชู ุฌูุจ ุฌููุน ุฎุฏูุงุช ุงูุจุงูุฉ ูุน ุชุญุฏูุฏ ุฎุงูุฉ "ุฅุฌุจุงุฑู" ุงูุชุฑุงุถูุงู

### โ 2. ุญุณุงุจ ุงูุณุงุนุงุช ุชููุงุฆูุงู
ูู ุฌุฏูู **ุชูุงุฑูุฎ ุงูุญุฌุฒ** (`package_booking_dates`):
- ุนูุฏ ุงุฎุชูุงุฑ **ููุช ุงูุจุฏุงูุฉ** (`start_time`) ู **ููุช ุงูููุงูุฉ** (`end_time`):
  - ูุชู ุญุณุงุจ ุนุฏุฏ ุงูุณุงุนุงุช ุชููุงุฆูุงู
  - ูุชู ูุถุน ุงููุชูุฌุฉ ูู ุญูู **ุนุฏุฏ ุงูุณุงุนุงุช** (`hours`)
  - ูุนุงูุฌุฉ ุญุงูุฉ ุนุจูุฑ ููุชุตู ุงูููู (ุฅุฐุง ูุงู ููุช ุงูููุงูุฉ ุฃุตุบุฑ ูู ุงูุจุฏุงูุฉ)

### โ 3. ุฌูุน ุฅุฌูุงูู ุงูุณุงุนุงุช ุงููุณุชุฎุฏูุฉ
- ูุชู ุฌูุน ูู ุงูุณุงุนุงุช ูู ุฌููุน ุตููู ุฌุฏูู **ุชูุงุฑูุฎ ุงูุญุฌุฒ**
- ุงููุชูุฌุฉ ุชูุถุน ูู ุญูู **ุนุฏุฏ ุงูุณุงุนุงุช ุงููุณุชุฎุฏูุฉ** (`used_hours`)
- ูุชู ุงูุชุญุฏูุซ ููุฑุงู ุนูุฏ ุชุบููุฑ ุฃู ููุช ูู ุงูุฌุฏูู

### โ 4. ุญุณุงุจ ุงูุณุงุนุงุช ุงููุชุจููุฉ
- ุงูุตูุบุฉ: `remaining_hours = total_hours - used_hours`
- ูุชู ุงูุชุญุฏูุซ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุฃู ุชุนุฏูู ุชูุงุฑูุฎ ุงูุญุฌุฒ
- ุงูุญุฏ ุงูุฃุฏูู = 0 (ูุง ูููู ุฃู ูููู ุณุงูุจุงู)

### โ 5. ููุน ุฅุถุงูุฉ ุญุฌูุฒุงุช ุนูุฏ ููุงุฏ ุงูุณุงุนุงุช
- ุนูุฏูุง `remaining_hours = 0`:
  - ูุชู ููุน ุฅุถุงูุฉ ุตููู ุฌุฏูุฏุฉ ูู ุฌุฏูู ุชูุงุฑูุฎ ุงูุญุฌุฒ
  - ูุธูุฑ ุชูุจูู: **"โ๏ธ ุชู ุงุณุชููุงุฏ ุฌููุน ุณุงุนุงุช ุงูุจุงูุฉ. ูุง ูููู ุฅุถุงูุฉ ุชูุงุฑูุฎ ุญุฌุฒ ุฅุถุงููุฉ"**
  - ูุชู ุญุฐู ุงูุตู ุงูุฌุฏูุฏ ุชููุงุฆูุงู

### โ 6. ุฑุณุงูุฉ ุงูุชุญุฐูุฑ ุงููุญุณูุฉ
- ุชู ุชุบููุฑ ุฑุณุงูุฉ ุงูุชุฌุงูุฒ ูู `throw` (ุฎุทุฃ ูููู ุงูุญูุธ) ุฅูู `msgprint` (ุชูุจูู ููุท)
- ุงูุฑุณุงูุฉ: **"โ๏ธ ุชู ุงุณุชููุงุฏ ุฌููุน ุณุงุนุงุช ุงูุจุงูุฉ"**
- ุชุธูุฑ ูู alert ูู ุงูุฃุณูู (ููุน: red indicator)
- ูุง ุชููู ุนูููุฉ ุงูุญูุธ

---

## ๐ง ุงูุชุทุจูู ุงูุชููู

### ูู ููู `booking.js`:

```javascript
// Event handlers ูุฌุฏูู Package Booking Date
frappe.ui.form.on('Package Booking Date', {
    start_time: function(frm, cdt, cdn) {
        calculate_hours_for_row(frm, cdt, cdn);
    },
    
    end_time: function(frm, cdt, cdn) {
        calculate_hours_for_row(frm, cdt, cdn);
    },
    
    package_booking_dates_add: function(frm, cdt, cdn) {
        check_remaining_hours_before_add(frm);
    }
});

// ูุธููุฉ ุญุณุงุจ ุงูุณุงุนุงุช ููุตู
function calculate_hours_for_row(frm, cdt, cdn) {
    // ุญุณุงุจ ุงููุฑู ุจูู start_time ู end_time
    // ุชุญุฏูุซ ุญูู hours
    // ุงุณุชุฏุนุงุก calculate_total_used_hours
}

// ูุธููุฉ ุฌูุน ุฅุฌูุงูู ุงูุณุงุนุงุช
function calculate_total_used_hours(frm) {
    // ุฌูุน ูู hours ูู package_booking_dates
    // ุชุญุฏูุซ used_hours
    // ุญุณุงุจ remaining_hours
    // ุนุฑุถ ุชูุจูู ุฅุฐุง ูุตูุช ูุตูุฑ
}

// ูุธููุฉ ููุน ุงูุฅุถุงูุฉ ุนูุฏ ุงูููุงุฏ
function check_remaining_hours_before_add(frm) {
    // ุงูุชุญูู ูู remaining_hours <= 0
    // ุญุฐู ุงูุตู ุงูุฌุฏูุฏ ุฅุฐุง ูุฒู ุงูุฃูุฑ
    // ุนุฑุถ ุชูุจูู
}
```

### ูู ููู `booking.py`:

```python
def compute_package_hours_usage(self):
    """
    - ุญุณุงุจ hours ููู ุตู ูู start_time & end_time
    - ุฌูุน used_hours
    - ุญุณุงุจ remaining_hours
    - ุนุฑุถ msgprint (ุจุฏูุงู ูู throw) ุนูุฏ ุงูุชุฌุงูุฒ
    """
    if self.booking_type != 'Package':
        return
    
    # ุฌูุจ total_hours ูู Package
    package_total = float(frappe.db.get_value('Package', self.package, 'total_hours') or 0)
    
    used = 0.0
    for row in (self.package_booking_dates or []):
        if row.start_time and row.end_time:
            # ุญุณุงุจ ุงููุฑู ุจุงูุณุงุนุงุช
            row.hours = calculate_time_difference(row.start_time, row.end_time)
        used += float(row.hours or 0)
    
    self.used_hours = round(used, 2)
    self.remaining_hours = max(package_total - used, 0.0)
    
    # ุฑุณุงูุฉ ุชุญุฐูุฑ (msgprint) ุจุฏูุงู ูู throw
    if package_total and self.used_hours > package_total:
        frappe.msgprint(
            msg=f"โ๏ธ ุชู ุงุณุชููุงุฏ ุฌููุน ุณุงุนุงุช ุงูุจุงูุฉ...",
            indicator="red"
        )
```

---

## ๐ ุณููุงุฑูู ุงูุงุณุชุฎุฏุงู

### ูุซุงู ุนููู:

1. **ุงุฎุชูุงุฑ ุงูุจุงูุฉ "Startup 1"** ุงูุชู ุชุญุชูู ุนูู **10 ุณุงุนุงุช**
   - โ `remaining_hours = 10`
   - โ `used_hours = 0`

2. **ุฅุถุงูุฉ ุชุงุฑูุฎ ุญุฌุฒ ุฃูู:**
   - ููุช ุงูุจุฏุงูุฉ: `10:00`
   - ููุช ุงูููุงูุฉ: `14:00`
   - โ ูุชู ุงูุญุณุงุจ: `hours = 4`
   - โ `used_hours = 4`
   - โ `remaining_hours = 6`

3. **ุฅุถุงูุฉ ุชุงุฑูุฎ ุญุฌุฒ ุซุงูู:**
   - ููุช ุงูุจุฏุงูุฉ: `15:00`
   - ููุช ุงูููุงูุฉ: `21:00`
   - โ ูุชู ุงูุญุณุงุจ: `hours = 6`
   - โ `used_hours = 10` (4 + 6)
   - โ `remaining_hours = 0`
   - โ๏ธ ูุธูุฑ ุชูุจูู: "ุชู ุงุณุชููุงุฏ ุฌููุน ุณุงุนุงุช ุงูุจุงูุฉ"

4. **ูุญุงููุฉ ุฅุถุงูุฉ ุชุงุฑูุฎ ุซุงูุซ:**
   - โ ูุชู ุฑูุถ ุงูุฅุถุงูุฉ
   - โ๏ธ ูุธูุฑ ุชูุจูู: "ูุง ูููู ุฅุถุงูุฉ ุชูุงุฑูุฎ ุญุฌุฒ ุฅุถุงููุฉ"
   - ุงูุตู ุงูุฌุฏูุฏ ููุญุฐู ุชููุงุฆูุงู

---

## โ ุงูุญุงูุงุช ุงููุนุงูุฌุฉ

### 1. ุนุจูุฑ ููุชุตู ุงูููู
```
start_time: 22:00
end_time: 02:00
Result: hours = 4 ุณุงุนุงุช โ
```

### 2. ุฃููุงุช ูุชุทุงุจูุฉ
```
start_time: 10:00
end_time: 10:00
Result: hours = 0 ุณุงุนุงุช โ
```

### 3. ุนุฏุฉ ุชูุงุฑูุฎ ุญุฌุฒ
```
Date 1: 3 ุณุงุนุงุช
Date 2: 5 ุณุงุนุงุช
Date 3: 2 ุณุงุนุงุช
Total used_hours: 10 ุณุงุนุงุช โ
```

### 4. ุชุฌุงูุฒ ุงูุณุงุนุงุช
```
Total package hours: 10
Used hours: 12
Result: 
- remaining_hours = 0
- msgprint alert (ูุง ูููุน ุงูุญูุธ) โ
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุงูุชูุจููุงุช (Alerts):

1. **ูุฌุงุญ ุชุญููู ุงูุจุงูุฉ:**
   ```
   โ ุชู ุชุญููู ุฎุฏูุงุช ุงูุจุงูุฉ ุจูุฌุงุญ
   (ุฃุฎุถุฑ - 3 ุซูุงู)
   ```

2. **ุชุญุฐูุฑ ููุงุฏ ุงูุณุงุนุงุช:**
   ```
   โ๏ธ ุชู ุงุณุชููุงุฏ ุฌููุน ุณุงุนุงุช ุงูุจุงูุฉ
   (ุฃุญูุฑ - 5 ุซูุงู)
   ```

3. **ููุน ุงูุฅุถุงูุฉ:**
   ```
   โ๏ธ ุชู ุงุณุชููุงุฏ ุฌููุน ุณุงุนุงุช ุงูุจุงูุฉ. 
   ูุง ูููู ุฅุถุงูุฉ ุชูุงุฑูุฎ ุญุฌุฒ ุฅุถุงููุฉ
   (ุฃุญูุฑ - 7 ุซูุงู)
   ```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ูุงุฎุชุจุงุฑ ุงูููุฒุฉ:

1. ุงูุชุญ ูููุฐุฌ Booking ุฌุฏูุฏ
2. ุงุฎุชุฑ **Booking Type = Package**
3. ุงุฎุชุฑ ุจุงูุฉ (ูุซู "Startup 1")
4. ุชุญูู ูู ููุก `remaining_hours` ุชููุงุฆูุงู
5. ุฃุถู ุชุงุฑูุฎ ุญุฌุฒ ูู ุฌุฏูู **ุชูุงุฑูุฎ ุงูุญุฌุฒ**
6. ุงุฎุชุฑ `start_time` ู `end_time`
7. ุชุญูู ูู ุญุณุงุจ `hours` ุชููุงุฆูุงู
8. ุฃุถู ุชูุงุฑูุฎ ุฃุฎุฑู ุญุชู ุชุตู ูููุงุฏ ุงูุณุงุนุงุช
9. ุญุงูู ุฅุถุงูุฉ ุชุงุฑูุฎ ุฌุฏูุฏ ุจุนุฏ ุงูููุงุฏ
10. ุชุญูู ูู ุธููุฑ ุงูุชูุจูู ูููุน ุงูุฅุถุงูุฉ

---

## ๐ ููุฎุต ุงูุญููู

| ุงูุญูู | ุงูููุน | ุงููุฑุงุกุฉ ููุท | ุงูุญุณุงุจ |
|------|------|------------|---------|
| `total_hours` | Float | โ | ูู Package |
| `used_hours` | Float | โ | ูุฌููุน hours ูู ุงูุฌุฏูู |
| `remaining_hours` | Float | โ | total - used |
| `hours` (ูู ุงูุฌุฏูู) | Float | โ | end_time - start_time |

---

## ๐ ุงูุชุฏูู ุงููุงูู

```
ุงุฎุชูุงุฑ ุงูุจุงูุฉ
    โ
ุชุนููู remaining_hours = total_hours
    โ
ุฅุถุงูุฉ ุชุงุฑูุฎ ุญุฌุฒ
    โ
ุงุฎุชูุงุฑ start_time & end_time
    โ
ุญุณุงุจ hours ุชููุงุฆูุงู [JavaScript]
    โ
ุฌูุน used_hours ูู ูู ุงูุตููู [JavaScript]
    โ
ุญุณุงุจ remaining_hours [JavaScript]
    โ
ุญูุธ ุงููุซููุฉ
    โ
ุฅุนุงุฏุฉ ุงูุญุณุงุจ ูุงูุชุญูู [Python]
    โ
msgprint ุฅุฐุง ุชุฌุงูุฒุช ุงูุณุงุนุงุช [Python]
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุญุณุงุจ ุงูุชููุงุฆู ูุชู ูู JavaScript** (ูุงุฌูุฉ ุงููุณุชุฎุฏู)
2. **ุงูุชุญูู ุงูููุงุฆู ูุชู ูู Python** (validate method)
3. **msgprint ูุง ูููุน ุงูุญูุธ** (ุนูู ุนูุณ throw)
4. **ูุนุงูุฌุฉ ุนุจูุฑ ููุชุตู ุงูููู** ุชุชู ุชููุงุฆูุงู
5. **ุงูุตููู ูุง ูููู ุฅุถุงูุชูุง** ุนูุฏ `remaining_hours = 0`

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุชุทุจูู **ูุธุงู ุญุณุงุจ ุณุงุนุงุช ุงูุจุงูุฉ** ุจุดูู ูุงูู ูุน:
- โ ุญุณุงุจ ุชููุงุฆู ููุณุงุนุงุช
- โ ุฌูุน ุงูุณุงุนุงุช ุงููุณุชุฎุฏูุฉ
- โ ุชุญุฏูุซ ุงูุณุงุนุงุช ุงููุชุจููุฉ
- โ ููุน ุงูุฅุถุงูุฉ ุนูุฏ ุงูููุงุฏ
- โ ุฑุณุงุฆู ุชุญุฐูุฑ ูุงุถุญุฉ ููููุฏุฉ
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ

ุงูุชุทุจูู ุฌุงูุฒ ููุงุฎุชุจุงุฑ! ๐
